{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# SharePoint è³‡æ–™å¤¾åˆ†äº«å·¥å…· (SSO ç‰ˆæœ¬) ğŸš€\n",
    "ä¸ä¸­æ–·æ¬Šé™ç¹¼æ‰¿ç‰ˆæœ¬ + ä¿®æ­£ SSL æ†‘è­‰å•é¡Œ\n",
    "è®“åˆ†äº«è®Šå¾—è·Ÿåœ¨ PTT æ¨æ–‡ä¸€æ¨£ç°¡å–®ï¼"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Step 1: å®‰è£å¿…è¦å¥—ä»¶"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "# å¦‚æœé‚„æ²’å®‰è£ï¼Œè«‹åŸ·è¡Œé€™å€‹ cell\n",
    "# !pip install Office365-REST-Python-Client requests"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Step 2: è¼‰å…¥å¿…è¦çš„å‡½å¼åº« + ä¿®æ­£ SSL å•é¡Œ"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "import os\n",
    "import ssl\n",
    "import warnings\n",
    "import urllib3\n",
    "from office365.runtime.auth.user_credential import UserCredential\n",
    "from office365.sharepoint.client_context import ClientContext\n",
    "import requests\n",
    "import getpass\n",
    "from urllib.parse import urlparse\n",
    "import json\n",
    "\n",
    "# é—œé–‰ SSL è­¦å‘Šï¼ˆå¦‚æœä½ çŸ¥é“ä½ åœ¨åšä»€éº¼çš„è©±ï¼‰\n",
    "urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)\n",
    "warnings.filterwarnings('ignore', message='Unverified HTTPS request')\n",
    "\n",
    "# è¨­å®š SSL è™•ç†\n",
    "os.environ['PYTHONWARNINGS'] = 'ignore:Unverified HTTPS request'\n",
    "\n",
    "# å»ºç«‹ä¸é©—è­‰çš„ SSL context\n",
    "ssl_context = ssl.create_default_context()\n",
    "ssl_context.check_hostname = False\n",
    "ssl_context.verify_mode = ssl.CERT_NONE\n",
    "\n",
    "print(\"âœ… å¥—ä»¶è¼‰å…¥å®Œæˆï¼SSL é©—è­‰å·²è¨­å®šç‚ºå¯¬é¬†æ¨¡å¼\")\n",
    "print(\"   ï¼ˆå°±åƒåœ¨å¤œå¸‚è²·æ±è¥¿ä¸ç”¨ç™¼ç¥¨ä¸€æ¨£ ğŸ˜…ï¼‰\")"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Step 3: è‡ªè¨‚ ClientContext ä»¥è™•ç† SSL å•é¡Œ"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "class CustomClientContext(ClientContext):\n",
    "    \"\"\"\n",
    "    è‡ªè¨‚çš„ ClientContextï¼Œè™•ç† SSL æ†‘è­‰å•é¡Œ\n",
    "    å°±åƒè‡ªå·±æ”¹è£æ©Ÿè»Šä¸€æ¨£ï¼\n",
    "    \"\"\"\n",
    "    def __init__(self, url):\n",
    "        super().__init__(url)\n",
    "        # è¦†å¯« requests çš„ session è¨­å®š\n",
    "        self.pending_request().beforeExecute += self._patch_request\n",
    "    \n",
    "    def _patch_request(self, request):\n",
    "        \"\"\"ä¿®æ”¹æ¯å€‹ request çš„ SSL è¨­å®š\"\"\"\n",
    "        # è¨­å®šä¸é©—è­‰ SSL\n",
    "        request.verify = False\n",
    "        return request"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Step 4: ä¸»è¦çš„åˆ†äº«é¡åˆ¥"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "class SharePointAutoSharer:\n",
    "    def __init__(self, site_url):\n",
    "        self.site_url = site_url\n",
    "        self.ctx = None\n",
    "        \n",
    "    def connect(self, username=None, password=None):\n",
    "        \"\"\"é€£æ¥åˆ° SharePoint\"\"\"\n",
    "        try:\n",
    "            if username and password:\n",
    "                # ä½¿ç”¨æä¾›çš„èªè­‰\n",
    "                print(f\"ğŸ” ä½¿ç”¨å¸³è™Ÿå¯†ç¢¼ç™»å…¥ï¼š{username}\")\n",
    "                self.ctx = CustomClientContext(self.site_url).with_credentials(\n",
    "                    UserCredential(username, password)\n",
    "                )\n",
    "            else:\n",
    "                # äº’å‹•å¼ç™»å…¥\n",
    "                print(\"ğŸ’¡ è«‹è¼¸å…¥ä½ çš„ Microsoft 365 èªè­‰è³‡è¨Šï¼š\")\n",
    "                username = input(\"ğŸ‘¤ ä½¿ç”¨è€…åç¨± (email): \")\n",
    "                password = getpass.getpass(\"ğŸ”‘ å¯†ç¢¼: \")\n",
    "                self.ctx = CustomClientContext(self.site_url).with_credentials(\n",
    "                    UserCredential(username, password)\n",
    "                )\n",
    "            \n",
    "            # æ¸¬è©¦é€£ç·š\n",
    "            web = self.ctx.web\n",
    "            self.ctx.load(web)\n",
    "            self.ctx.execute_query()\n",
    "            print(f\"âœ… æˆåŠŸé€£æ¥åˆ°ï¼š{web.properties['Title']}\")\n",
    "            return True\n",
    "            \n",
    "        except Exception as e:\n",
    "            print(f\"âŒ é€£ç·šå¤±æ•—ï¼š{str(e)}\")\n",
    "            print(\"   æç¤ºï¼š\")\n",
    "            print(\"   1. ç¢ºèªç¶²å€æ­£ç¢º\")\n",
    "            print(\"   2. ç¢ºèªå¸³è™Ÿå¯†ç¢¼æ­£ç¢º\")\n",
    "            print(\"   3. ç¢ºèªæœ‰æ¬Šé™å­˜å–æ­¤ç¶²ç«™\")\n",
    "            return False\n",
    "    \n",
    "    def find_user(self, display_name):\n",
    "        \"\"\"æ ¹æ“šé¡¯ç¤ºåç¨±å°‹æ‰¾ä½¿ç”¨è€…\"\"\"\n",
    "        print(f\"ğŸ” æœå°‹ä½¿ç”¨è€…ï¼š{display_name}\")\n",
    "        \n",
    "        try:\n",
    "            # æ–¹æ³• 1: ä½¿ç”¨ ensure_user ç›´æ¥å˜—è©¦\n",
    "            try:\n",
    "                # å…ˆå˜—è©¦ç”¨ email æ ¼å¼\n",
    "                email_attempt = f\"{display_name}@{urlparse(self.site_url).hostname.split('.')[0]}.com\"\n",
    "                user = self.ctx.web.ensure_user(email_attempt)\n",
    "                self.ctx.execute_query()\n",
    "                \n",
    "                return [{\n",
    "                    'Title': user.properties.get('Title'),\n",
    "                    'Email': user.properties.get('Email'),\n",
    "                    'LoginName': user.properties.get('LoginName'),\n",
    "                    'Id': user.properties.get('Id')\n",
    "                }]\n",
    "            except:\n",
    "                pass\n",
    "            \n",
    "            # æ–¹æ³• 2: æœå°‹æ‰€æœ‰ä½¿ç”¨è€…\n",
    "            users = self.ctx.web.site_users\n",
    "            self.ctx.load(users)\n",
    "            self.ctx.execute_query()\n",
    "            \n",
    "            found_users = []\n",
    "            for user in users:\n",
    "                user_title = user.properties.get('Title', '')\n",
    "                user_email = user.properties.get('Email', '')\n",
    "                \n",
    "                # æ’é™¤ç³»çµ±ä½¿ç”¨è€…\n",
    "                if 'system' in user_title.lower() or not user_email:\n",
    "                    continue\n",
    "                \n",
    "                # å®Œå…¨ç¬¦åˆæˆ–éƒ¨åˆ†ç¬¦åˆ\n",
    "                if (display_name.lower() in user_title.lower() or \n",
    "                    display_name.lower() in user_email.lower()):\n",
    "                    found_users.append({\n",
    "                        'Title': user_title,\n",
    "                        'Email': user_email,\n",
    "                        'LoginName': user.properties.get('LoginName'),\n",
    "                        'Id': user.properties.get('Id')\n",
    "                    })\n",
    "                    print(f\"âœ… æ‰¾åˆ°ä½¿ç”¨è€…ï¼š{user_title} ({user_email})\")\n",
    "            \n",
    "            if not found_users:\n",
    "                print(\"âŒ æ‰¾ä¸åˆ°ä½¿ç”¨è€…\")\n",
    "                print(\"   å¯èƒ½çš„åŸå› ï¼š\")\n",
    "                print(\"   1. åå­—æ‹¼éŒ¯äº†\")\n",
    "                print(\"   2. ä½¿ç”¨è€…ä¸åœ¨é€™å€‹ç¶²ç«™\")\n",
    "                print(\"   3. ä½¿ç”¨è€…å»è²·é›æ’é‚„æ²’å›ä¾† ğŸ˜‚\")\n",
    "            \n",
    "            return found_users\n",
    "            \n",
    "        except Exception as e:\n",
    "            print(f\"âŒ æœå°‹æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š{str(e)}\")\n",
    "            return []\n",
    "    \n",
    "    def share_folder_simple(self, folder_path, user_email_or_login, permission_level='Contribute'):\n",
    "        \"\"\"\n",
    "        åˆ†äº«è³‡æ–™å¤¾çµ¦æŒ‡å®šä½¿ç”¨è€…ï¼ˆä¸ä¸­æ–·æ¬Šé™ç¹¼æ‰¿ï¼‰\n",
    "        permission_level: 'Read', 'Contribute', 'Edit', 'Full Control'\n",
    "        \"\"\"\n",
    "        print(f\"\\nğŸ“ æº–å‚™åˆ†äº«è³‡æ–™å¤¾...\")\n",
    "        print(f\"   è·¯å¾‘ï¼š{folder_path}\")\n",
    "        print(f\"   åˆ†äº«çµ¦ï¼š{user_email_or_login}\")\n",
    "        print(f\"   æ¬Šé™ï¼š{permission_level}\")\n",
    "        \n",
    "        try:\n",
    "            # å–å¾—è³‡æ–™å¤¾\n",
    "            folder = self.ctx.web.get_folder_by_server_relative_url(folder_path)\n",
    "            self.ctx.load(folder)\n",
    "            self.ctx.execute_query()\n",
    "            print(\"âœ… æ‰¾åˆ°è³‡æ–™å¤¾\")\n",
    "            \n",
    "            # å–å¾—è³‡æ–™å¤¾çš„ ListItem\n",
    "            list_item = folder.listItemAllFields\n",
    "            self.ctx.load(list_item)\n",
    "            self.ctx.execute_query()\n",
    "            \n",
    "            # ç¢ºä¿ä½¿ç”¨è€…å­˜åœ¨\n",
    "            user = self.ctx.web.ensure_user(user_email_or_login)\n",
    "            self.ctx.execute_query()\n",
    "            print(f\"âœ… ç¢ºèªä½¿ç”¨è€…ï¼š{user.properties['Title']}\")\n",
    "            \n",
    "            # å–å¾—è§’è‰²å®šç¾©\n",
    "            role_def_name = {\n",
    "                'Read': 'Read',\n",
    "                'Contribute': 'Contribute',\n",
    "                'Edit': 'Edit',\n",
    "                'Full Control': 'Full Control'\n",
    "            }.get(permission_level, 'Contribute')\n",
    "            \n",
    "            role_def = self.ctx.web.role_definitions.get_by_name(role_def_name)\n",
    "            self.ctx.load(role_def)\n",
    "            self.ctx.execute_query()\n",
    "            print(f\"âœ… å–å¾—æ¬Šé™å®šç¾©ï¼š{role_def_name}\")\n",
    "            \n",
    "            # ç›´æ¥æ–°å¢æ¬Šé™ï¼ˆä¸ä¸­æ–·ç¹¼æ‰¿ï¼‰\n",
    "            role_assignment = list_item.role_assignments.add_role_assignment(\n",
    "                user, \n",
    "                role_def\n",
    "            )\n",
    "            self.ctx.execute_query()\n",
    "            \n",
    "            print(f\"\\nğŸ‰ æˆåŠŸåˆ†äº«è³‡æ–™å¤¾ï¼\")\n",
    "            print(f\"   {user.properties['Title']} ç¾åœ¨æœ‰ {permission_level} æ¬Šé™\")\n",
    "            print(\"   æ¬Šé™ç¹¼æ‰¿ä¿æŒä¸è®Šï¼Œå…¶ä»–äººçš„æ¬Šé™ä¸å—å½±éŸ¿\")\n",
    "            print(\"   ï¼ˆå°±åƒåŠ è–ªä¸å½±éŸ¿å…¶ä»–äººä¸€æ¨£ ğŸ˜„ï¼‰\")\n",
    "            \n",
    "            return True\n",
    "            \n",
    "        except Exception as e:\n",
    "            error_msg = str(e)\n",
    "            print(f\"\\nâŒ åˆ†äº«å¤±æ•—ï¼š{error_msg}\")\n",
    "            \n",
    "            # æä¾›æ›´è©³ç´°çš„éŒ¯èª¤èªªæ˜\n",
    "            if \"does not exist\" in error_msg:\n",
    "                print(\"   ğŸ“‚ æ‰¾ä¸åˆ°è³‡æ–™å¤¾ï¼Œè«‹ç¢ºèªè·¯å¾‘æ˜¯å¦æ­£ç¢º\")\n",
    "            elif \"Access denied\" in error_msg:\n",
    "                print(\"   ğŸ”’ æ¬Šé™ä¸è¶³ï¼Œä½ å¯èƒ½æ²’æœ‰ç®¡ç†æ­¤è³‡æ–™å¤¾çš„æ¬Šé™\")\n",
    "            elif \"user cannot be found\" in error_msg:\n",
    "                print(\"   ğŸ‘¤ æ‰¾ä¸åˆ°ä½¿ç”¨è€…ï¼Œè«‹ç¢ºèª email æˆ–ç™»å…¥åç¨±\")\n",
    "            else:\n",
    "                print(\"   ğŸ’¡ è«‹æª¢æŸ¥ç¶²è·¯é€£ç·šå’Œèªè­‰ç‹€æ…‹\")\n",
    "            \n",
    "            return False"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Step 5: å¿«é€Ÿä½¿ç”¨å‡½å¼"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "def quick_share_no_inheritance_break(site_url, folder_url, folder_name):\n",
    "    \"\"\"\n",
    "    å¿«é€Ÿåˆ†äº«å‡½å¼ - ä¸ä¸­æ–·æ¬Šé™ç¹¼æ‰¿ç‰ˆæœ¬\n",
    "    å°±åƒ Foodpanda ä¸€æ¨£å¿«é€Ÿï¼Œä½†ä¸æœƒæŠŠåŸæœ¬çš„é¤å»³é—œæ‰ï¼\n",
    "    \"\"\"\n",
    "    print(\"ğŸš€ SharePoint è³‡æ–™å¤¾åˆ†äº«å·¥å…·\")\n",
    "    print(\"   ï¼ˆä¸ä¸­æ–·æ¬Šé™ç¹¼æ‰¿ç‰¹åˆ¥ç‰ˆï¼‰\")\n",
    "    print(\"=\" * 50)\n",
    "    \n",
    "    # å»ºç«‹åˆ†äº«å·¥å…·\n",
    "    sharer = SharePointAutoSharer(site_url)\n",
    "    \n",
    "    # é€£æ¥\n",
    "    if not sharer.connect():\n",
    "        return False\n",
    "    \n",
    "    # å¾ URL è§£æè·¯å¾‘\n",
    "    parsed = urlparse(folder_url)\n",
    "    base_path = parsed.path\n",
    "    \n",
    "    # ç¢ºä¿è·¯å¾‘æ ¼å¼æ­£ç¢º\n",
    "    if not base_path.endswith('/'):\n",
    "        base_path += '/'\n",
    "    \n",
    "    # å®Œæ•´è³‡æ–™å¤¾è·¯å¾‘\n",
    "    full_folder_path = base_path + folder_name\n",
    "    print(f\"\\nğŸ“ å®Œæ•´è·¯å¾‘ï¼š{full_folder_path}\")\n",
    "    \n",
    "    # å°‹æ‰¾ä½¿ç”¨è€…\n",
    "    print(f\"\\nğŸ” å°‹æ‰¾ä½¿ç”¨è€…ï¼š{folder_name}\")\n",
    "    users = sharer.find_user(folder_name)\n",
    "    \n",
    "    if not users:\n",
    "        print(\"\\nğŸ˜¢ æ‰¾ä¸åˆ°ç¬¦åˆçš„ä½¿ç”¨è€…\")\n",
    "        # å˜—è©¦æ‰‹å‹•è¼¸å…¥\n",
    "        manual_email = input(\"\\nğŸ’¡ è¦ä¸è¦æ‰‹å‹•è¼¸å…¥ä½¿ç”¨è€… emailï¼Ÿ(è¼¸å…¥ email æˆ–æŒ‰ Enter è·³é): \").strip()\n",
    "        if manual_email:\n",
    "            return sharer.share_folder_simple(full_folder_path, manual_email, 'Contribute')\n",
    "        return False\n",
    "    \n",
    "    # å¦‚æœæœ‰å¤šå€‹ä½¿ç”¨è€…ï¼Œè®“ä½¿ç”¨è€…é¸æ“‡\n",
    "    if len(users) > 1:\n",
    "        print(\"\\næ‰¾åˆ°å¤šå€‹ä½¿ç”¨è€…ï¼Œè«‹é¸æ“‡ï¼š\")\n",
    "        for idx, user in enumerate(users):\n",
    "            print(f\"  {idx+1}. {user['Title']} - {user['Email']}\")\n",
    "        \n",
    "        choice = input(\"\\nè«‹è¼¸å…¥ç·¨è™Ÿ (é è¨­é¸ 1): \").strip() or \"1\"\n",
    "        try:\n",
    "            selected_user = users[int(choice) - 1]\n",
    "        except:\n",
    "            selected_user = users[0]\n",
    "    else:\n",
    "        selected_user = users[0]\n",
    "    \n",
    "    print(f\"\\nå·²é¸æ“‡ï¼š{selected_user['Title']} ({selected_user['Email']})\")\n",
    "    \n",
    "    # ç¢ºèªåˆ†äº«\n",
    "    confirm = input(\"\\nç¢ºå®šè¦åˆ†äº«å—ï¼Ÿ(Y/n): \").strip().lower()\n",
    "    if confirm == 'n':\n",
    "        print(\"å·²å–æ¶ˆåˆ†äº«\")\n",
    "        return False\n",
    "    \n",
    "    # åŸ·è¡Œåˆ†äº«\n",
    "    return sharer.share_folder_simple(\n",
    "        full_folder_path,\n",
    "        selected_user['LoginName'] or selected_user['Email'],\n",
    "        'Contribute'\n",
    "    )"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Step 6: å¯¦éš›ä½¿ç”¨ç¯„ä¾‹"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "# è¨­å®šä½ çš„è³‡è¨Š\n",
    "SITE_URL = \"https://your-company.sharepoint.com/sites/your-site\"\n",
    "FOLDER_BASE_URL = \"https://your-company.sharepoint.com/sites/your-site/Shared%20Documents/share/\"\n",
    "FOLDER_NAME = \"John Doe\"\n",
    "\n",
    "# åŸ·è¡Œåˆ†äº«\n",
    "# quick_share_no_inheritance_break(SITE_URL, FOLDER_BASE_URL, FOLDER_NAME)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Step 7: äº’å‹•å¼ä»‹é¢"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "def interactive_share():\n",
    "    \"\"\"\n",
    "    äº’å‹•å¼åˆ†äº«ä»‹é¢\n",
    "    å°±åƒåœ¨ PTT ç™¼æ–‡ä¸€æ¨£ç°¡å–®ï¼\n",
    "    \"\"\"\n",
    "    print(\"ğŸ¯ SharePoint è³‡æ–™å¤¾åˆ†äº«å·¥å…·\")\n",
    "    print(\"   ä¸ä¸­æ–·æ¬Šé™ç¹¼æ‰¿ç‰ˆæœ¬\")\n",
    "    print(\"=\" * 50)\n",
    "    \n",
    "    # æ”¶é›†è³‡è¨Š\n",
    "    site_url = input(\"\\nğŸ“ SharePoint ç¶²ç«™ URL\\n   (ä¾‹: https://company.sharepoint.com/sites/TeamSite): \").strip()\n",
    "    folder_base = input(\"\\nğŸ“‚ è³‡æ–™å¤¾åŸºç¤ URL\\n   (ä¾‹: https://company.sharepoint.com/sites/TeamSite/Documents/share/): \").strip()\n",
    "    folder_name = input(\"\\nğŸ‘¤ è³‡æ–™å¤¾åç¨±ï¼ˆé€šå¸¸æ˜¯äººåï¼‰: \").strip()\n",
    "    \n",
    "    # åŸ·è¡Œåˆ†äº«\n",
    "    result = quick_share_no_inheritance_break(site_url, folder_base, folder_name)\n",
    "    \n",
    "    if result:\n",
    "        print(\"\\nğŸŠ æ­å–œï¼åˆ†äº«æˆåŠŸï¼\")\n",
    "        print(\"   å¯ä»¥å»å–çå¥¶æ…¶ç¥äº† ğŸ§‹\")\n",
    "    else:\n",
    "        print(\"\\nğŸ˜… åˆ†äº«å¤±æ•—\")\n",
    "        print(\"   å¯èƒ½è¦æ‰¾ IT å¤§å¤§å¹«å¿™äº†\")\n",
    "\n",
    "# åŸ·è¡Œäº’å‹•å¼ä»‹é¢\n",
    "# interactive_share()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## é¡å¤–å·¥å…·ï¼šæ‰¹æ¬¡åˆ†äº«"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "def batch_share(site_url, folder_base_url, user_folder_pairs):\n",
    "    \"\"\"\n",
    "    æ‰¹æ¬¡åˆ†äº«å¤šå€‹è³‡æ–™å¤¾\n",
    "    å°±åƒåœ˜è³¼ä¸€æ¨£æ–¹ä¾¿ï¼\n",
    "    \n",
    "    user_folder_pairs: list of tuples [(folder_name, user_email), ...]\n",
    "    \"\"\"\n",
    "    print(\"ğŸ“¦ æ‰¹æ¬¡åˆ†äº«æ¨¡å¼å•Ÿå‹•ï¼\")\n",
    "    print(f\"   æº–å‚™åˆ†äº« {len(user_folder_pairs)} å€‹è³‡æ–™å¤¾\")\n",
    "    print(\"=\" * 50)\n",
    "    \n",
    "    # å»ºç«‹é€£ç·š\n",
    "    sharer = SharePointAutoSharer(site_url)\n",
    "    if not sharer.connect():\n",
    "        print(\"âŒ ç„¡æ³•é€£ç·š\")\n",
    "        return\n",
    "    \n",
    "    # è™•ç†æ¯å€‹åˆ†äº«\n",
    "    success_count = 0\n",
    "    for folder_name, user_email in user_folder_pairs:\n",
    "        print(f\"\\nè™•ç†ï¼š{folder_name} â†’ {user_email}\")\n",
    "        \n",
    "        full_path = folder_base_url.rstrip('/') + '/' + folder_name\n",
    "        \n",
    "        if sharer.share_folder_simple(full_path, user_email, 'Contribute'):\n",
    "            success_count += 1\n",
    "        else:\n",
    "            print(f\"   âš ï¸  {folder_name} åˆ†äº«å¤±æ•—\")\n",
    "    \n",
    "    print(f\"\\nğŸ“Š å®Œæˆï¼æˆåŠŸåˆ†äº« {success_count}/{len(user_folder_pairs)} å€‹è³‡æ–™å¤¾\")\n",
    "    print(\"   å°±åƒå¤–é€å¹³å°çš„æˆåŠŸç‡ä¸€æ¨£ ğŸ˜„\")\n",
    "\n",
    "# ä½¿ç”¨ç¯„ä¾‹ï¼š\n",
    "# batch_list = [\n",
    "#     (\"John Doe\", \"john.doe@company.com\"),\n",
    "#     (\"Jane Smith\", \"jane.smith@company.com\"),\n",
    "#     (\"Bob Chen\", \"bob.chen@company.com\")\n",
    "# ]\n",
    "# batch_share(SITE_URL, FOLDER_BASE_URL, batch_list)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## é™¤éŒ¯è³‡è¨Š"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "print(\"ğŸ’¡ å¦‚æœé‚„æ˜¯æœ‰ SSL å•é¡Œï¼Œå¯ä»¥å˜—è©¦ï¼š\")\n",
    "print(\"1. æ›´æ–° certifi: pip install --upgrade certifi\")\n",
    "print(\"2. è¨­å®šå…¬å¸ proxyï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰\")\n",
    "print(\"3. ä½¿ç”¨å…¬å¸å…§éƒ¨çš„æ†‘è­‰\")\n",
    "print(\"\\nç›®å‰ SSL è¨­å®šï¼šä¸é©—è­‰æ†‘è­‰ï¼ˆæ¸¬è©¦ç’°å¢ƒé©ç”¨ï¼‰\")\n",
    "print(\"æ­£å¼ç’°å¢ƒè«‹è€ƒæ…®ä½¿ç”¨é©ç•¶çš„æ†‘è­‰é©—è­‰ï¼\")"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.8.0"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}